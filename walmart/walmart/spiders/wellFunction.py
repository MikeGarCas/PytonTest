# -*- coding: utf-8 -*-
import scrapy
import json
from io import StringIO
from json import JSONEncoder
import pickle
from scrapy.http import Response
from scrapy.spiders import CrawlSpider, Rule
from scrapy.linkextractors import LinkExtractor
from w3lib.html import remove_tags, remove_tags_with_content



class WalSpider(CrawlSpider):
    name = 'wal'
    data = {'{"6000191197670":{"online":[{"maxCurrentPrice":3.27,"mapPrice":0,"maxRegularPrice":0,"minCurrentPrice":3.27,"minRegularPrice":0,"pricePerUnit":"50¢/100g","rollback":false,"date":"","limited":false,"asAdvertised":false,"sellerName":"Walmart","inventory":0,"offerType":"1P","reducedPrice":false,"sellerId":"0","gmEligible":false,"eligible":true,"clearance":false,"offerId":"6000191197671","sku":"6000191197671","limitedStock":true,"status":"Available"}],"stores":[],"onlineSummary":{"status":"Available","date":"","eligible":true,"gmEligible":false,"clearance":false,"rollback":false,"asAdvertised":false,"limited":false,"limitedStock":true,"minRegularPrice":0,"maxRegularPrice":0,"minCurrentPrice":3.27,"maxCurrentPrice":3.27}},"6000191197673":{"online":[{"maxCurrentPrice":3.27,"mapPrice":0,"maxRegularPrice":0,"minCurrentPrice":3.27,"minRegularPrice":0,"pricePerUnit":"50¢/100g","rollback":false,"date":"","limited":false,"asAdvertised":false,"sellerName":"Walmart","inventory":0,"offerType":"1P","reducedPrice":false,"sellerId":"0","gmEligible":false,"eligible":true,"clearance":false,"offerId":"6000191197674","sku":"6000191197674","limitedStock":true,"status":"Available"}],"stores":[],"onlineSummary":{"status":"Available","date":"","eligible":true,"gmEligible":false,"clearance":false,"rollback":false,"asAdvertised":false,"limited":false,"limitedStock":true,"minRegularPrice":0,"maxRegularPrice":0,"minCurrentPrice":3.27,"maxCurrentPrice":3.27}},"6000191197695":{"online":[{"maxCurrentPrice":3.27,"mapPrice":0,"maxRegularPrice":0,"minCurrentPrice":3.27,"minRegularPrice":0,"pricePerUnit":"50¢/100g","rollback":false,"date":"","limited":false,"asAdvertised":false,"sellerName":"Walmart","inventory":0,"offerType":"1P","reducedPrice":false,"sellerId":"0","gmEligible":false,"eligible":true,"clearance":false,"offerId":"6000191197696","sku":"6000191197696","limitedStock":true,"status":"Available"}],"stores":[],"onlineSummary":{"status":"Available","date":"","eligible":true,"gmEligible":false,"clearance":false,"rollback":false,"asAdvertised":false,"limited":false,"limitedStock":true,"minRegularPrice":0,"maxRegularPrice":0,"minCurrentPrice":3.27,"maxCurrentPrice":3.27}},"6000191197654":{"online":[{"maxCurrentPrice":3.27,"mapPrice":0,"maxRegularPrice":0,"minCurrentPrice":3.27,"minRegularPrice":0,"pricePerUnit":"50¢/100g","rollback":false,"date":"","limited":false,"asAdvertised":false,"sellerName":"Walmart","inventory":0,"offerType":"1P","reducedPrice":false,"sellerId":"0","gmEligible":false,"eligible":true,"clearance":false,"offerId":"6000191197655","sku":"6000191197655","limitedStock":true,"status":"Available"}],"stores":[],"onlineSummary":{"status":"Available","date":"","eligible":true,"gmEligible":false,"clearance":false,"rollback":false,"asAdvertised":false,"limited":false,"limitedStock":true,"minRegularPrice":0,"maxRegularPrice":0,"minCurrentPrice":3.27,"maxCurrentPrice":3.27}},"6000061091415":{"online":[{"maxCurrentPrice":3.27,"mapPrice":0,"maxRegularPrice":0,"minCurrentPrice":3.27,"minRegularPrice":0,"pricePerUnit":"50¢/100g","rollback":false,"date":"","limited":false,"asAdvertised":false,"sellerName":"Walmart","inventory":0,"offerType":"1P","reducedPrice":false,"sellerId":"0","gmEligible":false,"eligible":true,"clearance":false,"offerId":"10156416","sku":"10156416","limitedStock":true,"status":"Available"}],"stores":[],"onlineSummary":{"status":"Available","date":"","eligible":true,"gmEligible":false,"clearance":false,"rollback":false,"asAdvertised":false,"limited":false,"limitedStock":true,"minRegularPrice":0,"maxRegularPrice":0,"minCurrentPrice":3.27,"maxCurrentPrice":3.27}},"6000001845809":{"online":[{"maxCurrentPrice":3.27,"mapPrice":0,"maxRegularPrice":0,"minCurrentPrice":3.27,"minRegularPrice":0,"pricePerUnit":"72¢/100g","rollback":false,"date":"","limited":false,"asAdvertised":false,"sellerName":"Walmart","inventory":0,"offerType":"1P","reducedPrice":false,"sellerId":"0","gmEligible":false,"eligible":true,"clearance":false,"offerId":"10156363","sku":"10156363","limitedStock":true,"status":"Available"}],"stores":[],"onlineSummary":{"status":"Available","date":"","eligible":true,"gmEligible":false,"clearance":false,"rollback":false,"asAdvertised":false,"limited":false,"limitedStock":true,"minRegularPrice":0,"maxRegularPrice":0,"minCurrentPrice":3.27,"maxCurrentPrice":3.27}}}'}

    def start_requests(self):
        payload = '{"products":{"738912":[{"sku":"738913","upc":[]}],"6000195954566":[{"sku":"6000195954567","upc":[]}],"6000199195450":[{"sku":"6000199195451","upc":[]}],"PRD1BQCVDDAATWL":[{"sku":"1BQCVDDAATWL","upc":[]}],"6000197851967":[{"sku":"6000197851968","upc":[]}],"6000199195842":[{"sku":"6000199195843","upc":[]}],"6000199207924":[{"sku":"6000199207925","upc":[]}],"6000195954530":[{"sku":"6000195954531","upc":[]}],"6000197852560":[{"sku":"6000197852561","upc":[]}],"6000196689877":[{"sku":"6000196689878","upc":[]}]},"origin":"shelf"}'
        url = "https://www.walmart.ca/en/grocery/N-117"
        headers = {
            "Accept": "application/json, text/javascript, */*; q=0.01",
            "Accept-Encoding": "gzip, deflate, br",
            "Accept-Language": "es-ES,es;q=0.9,en;q=0.8",
            "Content-Type": "application/json; charset=UTF-8",
            "Cookie": "walmart.shippingPostalCode=P7B3Z7; defaultNearestStoreId=3124; zone=9; deliveryCatchment=3124; walmart.csrf=f88f4b5149adef8d907736a1; wmt.c=0; vtc=WlrDORHfE5eaKvhzqakNKE; userSegment=10-percent; TBV=7; rxVisitor=15887896828899FUFOLKLATMA611L568OGF85KAPCHTRC; headerType=grocery; AMCVS_C4C6370453309C960A490D44%40AdobeOrg=1; walmart.id=08ab1e32-3a4a-49fd-88ae-28218bf762bf; usrState=1; _ga=GA1.2.484015444.1588875313; s_ecid=MCMID%7C05034263762608013960105857420568304998; walmart.nearestPostalCode=P7B3Z7; walmart.locale=en; _gcl_au=1.1.779450552.1588875313; og_session_id=af0a84f8847311e3b233bc764e1107f2.173286.1588875313; og_session_id_conf=af0a84f8847311e3b233bc764e1107f2.173286.1588875313; s_visit=1; _fbp=fb.1.1588875313733.844915520; s_cc=true; __gads=ID=d10600aed34d6fd1:T=1588875312:S=ALNI_MaGYlHwled0ITkov_MQymv3gq6wyw; og_autoship=0; _pin_unauth=MWM2MWQyMDEtODFmZi00Zjg4LWFjOTYtNDIxNzRhM2VlNmM0; walmart.nearestLatLng='48.4120872,-89.2413988'; dtSa=-; dtLatC=13; rxVisitor=15887896828899FUFOLKLATMA611L568OGF85KAPCHTRC; enableHTTPS=1; dtSa=-; dtCookie=22$T4CF2FTNEMMV3A34NTKGFK21570UOEBN|5b6d58542e634882|0; AMCV_C4C6370453309C960A490D44%40AdobeOrg=-408604571%7CMCIDTS%7C18394%7CMCMID%7C05034263762608013960105857420568304998%7CMCAAMLH-1589840438%7C7%7CMCAAMB-1589840438%7CRKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7CMCOPTOUT-1589242838s%7CNONE%7CMCAID%7CNONE%7CvVersion%7C4.6.0; _gid=GA1.2.899032113.1589235639; s_sq=%5B%5BB%5D%5D; previousBreakpoint=mobile; wmt.breakpoint=m; s_gnr=1589236175304-Repeat; ENV=ak-dfw-prod; bstc=eDbL1gncLdFrMOikJGxiWg; xpa=34JTv|HeXkG|LVSOt|MPTAC|MZ9tt|NOECn|NOaJP|btyTC|eP05T|gbvoH|jeBOs|lZnE7|mOlOu|oygXn|pXPz1|qvGc6|sGGbM|ssJZF|t5K4Y|xzlm3|yI7_k|yntCW|zilS-; exp-ck=34JTv2HeXkG1LVSOt1MPTACkMZ9tt1NOECn2NOaJPHbtyTC1eP05T1gbvoH1jeBOs8lZnE76mOlOuIoygXn1pXPz13qvGc62sGGbM4ssJZF7t5K4Y1xzlm33yI7_k1yntCW1zilS-3; TS01f4281b=0130aff232eb4a78ddaf0b5a7c1d09f58578481daa095ab07b2ec941a068665d5a728d11d41fd248c0724e8e5044e041c872d23a06; TS011fb5f6=0130aff232eb4a78ddaf0b5a7c1d09f58578481daa095ab07b2ec941a068665d5a728d11d41fd248c0724e8e5044e041c872d23a06; TS0175e29f=0130aff232eb4a78ddaf0b5a7c1d09f58578481daa095ab07b2ec941a068665d5a728d11d41fd248c0724e8e5044e041c872d23a06; akaau_P1=1589249999~id=581b7e77ece54e0930f40fae41509094; rxvt=1589250000058|1589248012866; dtPC=22$448200046_67h1vXBTXAKEWMXNSBIGMPYXXOSAJDFBSPUIS-0; _4c_= 'jVNdb5swFP0rlaX1KYA%2FwJhIVZVmVbdpadeuUx%2BRazvBKgFknLIsyn%2FfNU368VZe4J57zuVe3%2BMdGirToCnJREFTQTEljE%2FQk9n2aLpDzurwekZTZHJecEVkJJZGRWnBRVSoXEcqX7LMCJ4taY4m6G%2BoVfC0EIzjNC32E6SbYw1tlnJT%2BzdahjNOc8IF0OyRJT%2FmGc8Zg7wbDoRjIuNFWnygjghQVXeg7tDG1VCy8r7rp0kyDEM8yHotnY%2BVTEyTrFyrjNsm1xEhoX%2FVagMCUsQiziD2%2FyCKGMbw3blWb5Qv%2FbYLnME8nvT6CRLaPFtlysFqXwUxFfgNrYxdVR7gnI5o5wJlLD7YRrfDqw5O%2Fw18lXESZI%2BuHXoTpPPKtWtzIgigLWwJPYyCHkJnlsa5kfXJic%2BtsvqsgoJfKO7kypTffpVz6c2qddvy3tamvHrhlw8L%2BENv%2FTj6a8UDBoYBOJxR2GCYrW6VrAMX7DVBV7Pyz%2Fev4zQ54yxN0xgsJ%2BBIWB7YN4v7u%2FLicja%2FuX7XfLturN84E%2FV9%2FX6Kx6Tvk2FtlWyklmEtCUl%2B%2FI5oTESMo5%2BzO5b0jImMCzA15oTm57PbizNyuoZpcYZZSjnLOeVYYMIKjgnORJanFEwkGE6LQpzObi%2FPyLG1xXzs%2FnNSEN07u1oZtzC%2BauEKQSy19bZtZI1ebsS7y6DDmlUt%2B94qbfon33ZofzC2KBijnLCcEjCjBzMLnuLw7Pf7%2Fw%3D%3D'; _uetsid=_uetec6faf63-2714-a1a6-39d3-e374a14f0eef; xpm=1%2B1589247775%2BWlrDORHfE5eaKvhzqakNKE~%2B0; _derived_epik=dj0yJnU9SGV3OEVrcW8yWWNnSDliUWplMDc0MzJuNEdtcEVzelUmbj0tT1RPTTV6ZC1kUjZLOGZOTlBkYUNBJm09NyZ0PUFBQUFBRjY2QU1v; seqnum=5,Host: www.walmart.ca",            "Origin": "https://www.walmart.ca",
            "Referer": "https://www.walmart.ca/en/grocery/N-117",
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36",
            "X-Requested-With": "XMLHttpRequest"
        }

        yield scrapy.Request(url=url, body=payload, method="POST", headers=headers, callback=self.parse)

    def parse(self, response):
        print(response.text)
        pass